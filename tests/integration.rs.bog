#[file(
  owner = "analysis-agent",
  subsystem = "test-fixtures",
  updated = "2026-02-24",
  status = green
)]

#[description {
  Integration tests. Validates config loading, parsing, tree-sitter extraction,
  function validation, skimsystem validation, and dogfood tests that ensure
  bog validates itself including its own skimsystem annotations.
}]

#[health(
  test_coverage = green,
  staleness = green
)]

#[skim(tracing) {
  status = green,
  notes = "Test file; tracing not applicable to test functions"
}]

#[fn(test_config_loading) {
  status = green,
  deps = [config::load_config],
  description = "Verifies bog.toml parsing"
}]

#[fn(test_repo_bog_parsing) {
  status = green,
  deps = [parser::parse_bog],
  description = "Verifies repo.bog parses correctly"
}]

#[fn(test_file_bog_parsing) {
  status = green,
  deps = [parser::parse_bog],
  description = "Verifies parser.rs.bog parses with all annotation types"
}]

#[fn(test_fixture_bog_parsing) {
  status = green,
  deps = [parser::parse_bog],
  description = "Verifies test fixture .bog file parses"
}]

#[fn(test_treesitter_validates_functions) {
  status = green,
  deps = [treesitter::extract_symbols],
  description = "Verifies tree-sitter extracts function names from fixture"
}]

#[fn(test_validate_functions_match) {
  status = green,
  deps = [validator::validate_syntax, validator::validate_functions],
  description = "Verifies .bog fn annotations match source functions"
}]

#[fn(test_validate_functions_catches_mismatch) {
  status = green,
  deps = [parser::parse_bog, validator::validate_functions],
  description = "Verifies validator catches fn annotations for non-existent functions"
}]

#[fn(test_dogfood_validate) {
  status = green,
  deps = [validator::validate_project],
  description = "Ensures bog validates its own .bog annotations"
}]

#[fn(test_dogfood_health) {
  status = green,
  deps = [health::compute_health],
  description = "Ensures health report works on bog itself"
}]

#[fn(test_dogfood_skimsystem_declared) {
  status = green,
  deps = [parser::parse_bog],
  description = "Ensures bog declares at least one skimsystem"
}]

#[fn(test_dogfood_skim_observations_valid) {
  status = green,
  deps = [validator::validate_project],
  description = "Ensures all skim observations reference valid skimsystems"
}]

#[fn(test_dogfood_skimsystem_health) {
  status = green,
  deps = [health::compute_health],
  description = "Ensures skimsystem health is computed with observations"
}]

#[fn(test_dogfood_every_subsystem_has_files) {
  status = green,
  deps = [health::compute_health],
  description = "Ensures every declared subsystem has annotated files"
}]

#[fn(workspace_root) {
  status = green,
  description = "Test helper: resolves workspace root from CARGO_MANIFEST_DIR"
}]

#[fn(test_dogfood_code_quality_integration) {
  status = green,
  deps = [parser::parse_bog, workspace_root],
  description = "Ensures code-quality skimsystem declaration parses with integrations block"
}]

#[fn(test_context_all_scope) {
  status = green,
  deps = [context::load_context, workspace_root],
  description = "Verifies load_context with All scope returns annotated files and subsystems"
}]

#[fn(test_context_agent_scope) {
  status = green,
  deps = [context::load_context, workspace_root],
  description = "Verifies load_context with Agent scope returns only that agent's subsystem files"
}]

#[fn(test_context_subsystem_scope) {
  status = green,
  deps = [context::load_context, workspace_root],
  description = "Verifies load_context with Subsystem scope returns only that subsystem's files"
}]

#[fn(test_context_unknown_agent_error) {
  status = green,
  deps = [context::load_context, workspace_root],
  description = "Verifies load_context returns UnknownAgent error for unregistered agent"
}]

#[fn(test_context_section_filter) {
  status = green,
  deps = [context::load_context, workspace_root],
  description = "Verifies SectionFilter correctly filters out unselected annotation types"
}]

#[fn(test_context_json_serializable) {
  status = green,
  deps = [context::load_context, workspace_root],
  description = "Verifies ContextOutput serializes to valid JSON with expected structure"
}]
