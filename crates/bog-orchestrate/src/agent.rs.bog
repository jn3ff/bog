#[file(
  owner = "orchestrate-agent",
  subsystem = "orchestrate",
  updated = "2026-02-25",
  status = green
)]

#[description {
  Agent task execution. Runs a single agent task inside an isolated git
  worktree: resolves agent role, builds the appropriate system prompt,
  invokes the provider with write tools, auto-commits, diffs, and checks
  permissions against ownership boundaries.
}]

#[health(
  test_coverage = yellow,
  staleness = green,
  complexity = green,
  contract_compliance = green
)]

#[fn(execute_agent_task) {
  status = green,
  deps = [prompt::build_subsystem_agent_prompt, prompt::build_skimsystem_agent_prompt, permissions::check_agent_permissions],
  contract = {
    in = [(ctx, RepoContext), (task, AgentTask), (task_index, usize), (worktree, AgentWorktree), (provider, Provider)],
    out = "Result<AgentResult, OrchestrateError>"
  },
  description = "Executes agent in worktree: invoke provider, auto-commit, diff, check permissions"
}]

#[skim(tracing) {
  status = red,
  notes = "No tracing instrumentation. execute_agent_task needs INFO at start/completion with agent name, DEBUG with files modified count, WARN on permission violations."
}]

#[skim(annotation-quality) {
  status = yellow,
  notes = "No unit tests for execute_agent_task; relies on integration testing via live provider"
}]
