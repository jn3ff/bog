#[file(
  owner = "orchestrate-agent",
  subsystem = "orchestrate",
  updated = "2026-02-25",
  status = green
)]

#[description {
  System prompt builders for dock, subsystem, and skimsystem agents.
  Interpolates RepoContext data (agent registry, subsystem ownership,
  skimsystem principles) into structured prompt strings.
}]

#[health(
  test_coverage = green,
  staleness = green,
  complexity = green,
  contract_compliance = green
)]

#[fn(build_dock_system_prompt) {
  status = green,
  contract = {
    in = [(ctx, RepoContext)],
    out = "String"
  },
  description = "Builds dock agent system prompt with repo.bog, agents, subsystems, skimsystems, and JSON schema"
}]

#[fn(build_dock_replan_prompt) {
  status = green,
  deps = [build_dock_system_prompt],
  contract = {
    in = [(ctx, RepoContext), (violations, Vec), (attempt, usize)],
    out = "String"
  },
  description = "Extends dock prompt with PREVIOUS ATTEMPT FAILED section listing violations"
}]

#[fn(build_subsystem_agent_prompt) {
  status = green,
  contract = {
    in = [(ctx, RepoContext), (agent_name, str), (task, AgentTask)],
    out = "String"
  },
  description = "Builds subsystem agent prompt with owned globs as strict boundary and task instruction"
}]

#[fn(build_skimsystem_agent_prompt) {
  status = green,
  contract = {
    in = [(ctx, RepoContext), (agent_name, str), (task, AgentTask)],
    out = "String"
  },
  description = "Builds skimsystem agent prompt with principles, .bog-only boundary, and change_request format"
}]

#[fn(load_ctx) {
  status = green,
  description = "Test helper: loads RepoContext from workspace root"
}]

#[fn(test_dock_prompt_contains_agents) {
  status = green,
  deps = [build_dock_system_prompt, load_ctx],
  description = "Verifies all agent names appear in dock prompt"
}]

#[fn(test_dock_prompt_contains_json_schema) {
  status = green,
  deps = [build_dock_system_prompt, load_ctx],
  description = "Verifies JSON schema keys appear in dock prompt"
}]

#[fn(test_subsystem_prompt_contains_globs) {
  status = green,
  deps = [build_subsystem_agent_prompt, load_ctx],
  description = "Verifies subsystem prompt includes owned files and STRICT BOUNDARY"
}]

#[fn(test_skimsystem_prompt_contains_principles) {
  status = green,
  deps = [build_skimsystem_agent_prompt, load_ctx],
  description = "Verifies skimsystem prompt includes .bog-only boundary and change_request format"
}]

#[fn(test_replan_prompt_includes_violations) {
  status = green,
  deps = [build_dock_replan_prompt, load_ctx],
  description = "Verifies replan prompt embeds violation details"
}]

#[skim(tracing) {
  status = red,
  notes = "No tracing instrumentation. Prompt builders need TRACE with prompt length. build_dock_replan_prompt needs DEBUG with attempt number and violation count."
}]

#[skim(annotation-quality) {
  status = green,
  notes = "All functions annotated with contracts and descriptions"
}]
